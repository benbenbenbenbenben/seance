<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-tree/paper-tree.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="electron-quick-start-app">
  <template>
    <style>
      :host {
        display: block;
        --paper-tree-selected-color: black;
        font-family:sans-serif;
        font-size: 0.8em;
      }
      .node-name {
        color: red;
      }
    </style>

    <paper-tree id="tree" actions='[{
        "label": "Play",
        "event": "play"
    }]' on-dblclick="doubleClickTreeItem">
 </paper-tree>

  </template>

  <script>
    Polymer({

      is: 'electron-quick-start-app',

      properties: {
        prop1: {
          type: String,
          value: 'electron-quick-start-app',
        },
      },

      doubleClickTreeItem: function(event) {
        debugger;
      },

      ready: function() {
        this.$.tree.data = {name:"loading...", icon:"cached"};
        var tree = this.$.tree;
        var data = {name:"examples", icon:"folder", children:[]};
        const testFolder = 'C:\\Users\\ben\\Source\\Repos\\electron-quick-start\\examples';

        var chokidar = require('chokidar');

        // One-liner for current directory, ignores .dotfiles
        chokidar.watch('.', {cwd:testFolder, ignored: /(^|[\/\\])\../}).on('all', (event, path) => {

          switch(event) {
            case "add":
              var icon = "icons:assignment";
            case "addDir":
              var at = data.children;
              var split = path.replace(/\\/g,"/").split("/");
              split.forEach((node, i) => {
                if (node == "." || node == "")
                  return;
                if (at.filter(any => any.name == node).length == 0) {
                  at.push({name:node, icon:icon || "icons:folder", children:[]});
                }
                at = at.filter(any => any.name == node)[0].children;
              });
              break;
            case "unlink":
            break;
            case "unlinkDir":
            break;
          }
        }).on('ready', () => {
          console.log("ready");
          tree.data = data;
        });




      },

      openImage: function() {
        const {dialog} = require('electron').remote
        console.log(dialog.showOpenDialog({
          properties: ['openFolder']}))
      },

      takeScreenshot: function() {
        rendererFunc();
      }

    });
  </script>
</dom-module>
